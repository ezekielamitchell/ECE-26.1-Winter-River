# Grafana Data Source Provisioning
# Automatically configure data sources on startup.
#
# ${INFLUXDB_TOKEN} is expanded from the grafana-server process environment,
# which is populated by /etc/default/grafana-server (written by setup_pi.sh).

apiVersion: 1

datasources:
  # ── InfluxDB v2 (primary time-series store, written by Telegraf) ─────────────
  - name: InfluxDB-MQTT
    type: influxdb
    access: proxy
    url: http://localhost:8086
    jsonData:
      version: Flux
      organization: iot-project
      defaultBucket: mqtt_metrics
      tlsSkipVerify: true
    secureJsonData:
      # Token is injected at runtime from /etc/default/grafana-server
      token: ${INFLUXDB_TOKEN}
    isDefault: true
    editable: true

  # ── MQTT Live (real-time panel streaming via WebSocket) ──────────────────────
  # Requires: grafana-cli plugins install grafana-mqtt-datasource
  # Mosquitto WebSocket listener must be enabled on port 9001 (see mosquitto_setup.sh)
  - name: MQTT-Live
    type: grafana-mqtt-datasource
    access: proxy
    editable: true
    jsonData:
      uri: ws://192.168.4.1:9001
